<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>金星満ち欠けシミュレーター（地球・太陽固定）</title>
    <style>
        body { background-color: #0a0a0c; color: #e0e0e0; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; }
        canvas { border: 1px solid #444; background-color: #000; border-radius: 8px; }
        .controls { margin-bottom: 20px; padding: 15px; background: #1a1a1d; border-radius: 10px; border: 1px solid #333; }
        .label { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; text-align: center; color: #aaa; }
    </style>
</head>
<body>

    <h2>金星の満ち欠け：地球・太陽固定モデル</h2>

    <div class="controls">
        公転速度: <input type="range" id="speedRange" min="0" max="0.05" step="0.001" value="0.015">
        <span>（反時計回り）</span>
    </div>

    <div class="container">
        <div>
            <div class="label">1. 位置関係 (地球と太陽を固定)</div>
            <canvas id="orbitCanvas" width="450" height="500"></canvas>
        </div>

        <div>
            <div class="label">2. 地球から見た金星</div>
            <canvas id="viewCanvas" width="450" height="500"></canvas>
        </div>
    </div>

    <script>
        const orbitCanvas = document.getElementById('orbitCanvas');
        const orbitCtx = orbitCanvas.getContext('2d');
        const viewCanvas = document.getElementById('viewCanvas');
        const viewCtx = viewCanvas.getContext('2d');
        const speedInput = document.getElementById('speedRange');

        let angleVenus = Math.PI / 2; // 金星の初期位置
        const cx = 225, cy = 250; // キャンバス中心
        
        // 固定位置の設定
        const sunY = 200;    // 太陽のY座標
        const earthY = 420;  // 地球のY座標
        const orbitR = 120;  // 金星の公転半径（太陽中心）

        function draw() {
            orbitCtx.clearRect(0, 0, 450, 500);
            viewCtx.clearRect(0, 0, 450, 500);

            // --- 1. 位置関係の描画 ---
            // 太陽（固定）
            orbitCtx.fillStyle = "yellow";
            orbitCtx.shadowBlur = 15; orbitCtx.shadowColor = "orange";
            orbitCtx.beginPath(); orbitCtx.arc(cx, sunY, 25, 0, Math.PI * 2); orbitCtx.fill();
            orbitCtx.shadowBlur = 0;
            orbitCtx.fillStyle = "white"; orbitCtx.fillText("太陽", cx - 12, sunY - 35);

            // 金星の軌道（太陽中心）
            orbitCtx.strokeStyle = "#333";
            orbitCtx.setLineDash([5, 5]);
            orbitCtx.beginPath(); orbitCtx.arc(cx, sunY, orbitR, 0, Math.PI * 2); orbitCtx.stroke();

            // 地球（固定）
            orbitCtx.fillStyle = "#44f";
            orbitCtx.beginPath(); orbitCtx.arc(cx, earthY, 12, 0, Math.PI * 2); orbitCtx.fill();
            orbitCtx.fillStyle = "white"; orbitCtx.fillText("地球", cx - 12, earthY + 25);

            // 金星の位置計算（太陽中心に反時計回り）
            const vx = cx + orbitR * Math.cos(angleVenus);
            const vy = sunY + orbitR * Math.sin(angleVenus);

            // 地球と金星を結ぶ点線
            orbitCtx.strokeStyle = "rgba(255, 255, 255, 0.4)";
            orbitCtx.setLineDash([2, 2]);
            orbitCtx.beginPath(); orbitCtx.moveTo(cx, earthY); orbitCtx.lineTo(vx, vy); orbitCtx.stroke();

            // 金星
            orbitCtx.fillStyle = "#ff0";
            orbitCtx.beginPath(); orbitCtx.arc(vx, vy, 8, 0, Math.PI * 2); orbitCtx.fill();

            // --- 2. 地球から見た満ち欠けの描画 ---
            // 地球から見た金星のベクトル
            const dx = vx - cx;
            const dy = vy - earthY;
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            // 離角（地球から見た太陽と金星の角度差）の計算
            // 地球から見て太陽は真上(北)にあるとする
            const angleToVenus = Math.atan2(dy, dx);
            const sunToEarthAngle = -Math.PI / 2; // 真上方向
            const elongation = angleToVenus - sunToEarthAngle;

            viewCtx.save();
            viewCtx.translate(225, 250);
            
            // 距離に応じて大きさを変える（内合で大きく、外合で小さく）
            const displayR = 12000 / dist; 

            // 金星の向き（常に太陽の方角が明るくなるように回転）
            viewCtx.rotate(angleToVenus + Math.PI/2);

            // 土台（暗い部分）
            viewCtx.fillStyle = "#111";
            viewCtx.beginPath(); viewCtx.arc(0, 0, displayR, 0, Math.PI * 2); viewCtx.fill();

            // 光が当たっている部分
            viewCtx.fillStyle = "#fffca0";
            const cosE = Math.cos(elongation);
            
            viewCtx.beginPath();
            viewCtx.arc(0, 0, displayR, -Math.PI/2, Math.PI/2, false);
            // 位相に合わせて楕円で影の境界を描く
            viewCtx.ellipse(0, 0, displayR * Math.abs(cosE), displayR, 0, Math.PI/2, -Math.PI/2, cosE < 0);
            viewCtx.fill();
            viewCtx.restore();

            // 更新
            angleVenus -= parseFloat(speedInput.value); // 反時計回り
            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>

        draw();
    </script>
</body>
</html>
